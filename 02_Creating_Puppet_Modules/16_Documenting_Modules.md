# Documenting Modules

- Good documentation ensures that others can use your module.
  - Enables others to build modules that depend on yours in a manner that you can support.

## Learning Markdown

- Previously Puppet used RDoc format, but has migrated to Markdown.
- Basic Markdown rules:
  - Paragraphs should be typed as-is, with no special formatting.
  - Code blocks should be indented 4 spaces or surrounded by ```.
  - Headers start with one # sign for each level (#header1, ##header2, ...).
  - Bullet lists start with a leading asterisk, dash, or plus sign.
  - Numbered lists start with a leading number and a period.
  - Use spaces to indent for list and code block hierarchy.
  - Add two spaces to the end of a line to add a line feed.
  - Surround words with *single asterisks* (*) for italic text.
  - Surround words with **double asterisks** (**) for bold text.

## Writing a Good README

- An initial README.md template is generated by `puppet module generate`.
- The README should explain what your module does and how to do it, so that users do not need to read through your manifests.
- It should include:
  - A list of all dependencies required by your module.
  - A list of all parameters used by your module.
  - An example Hiera configuration for a common use case.

## Documenting the Classes and Types

- Each class and defined type should be documented in the manifest.

### Installing YARD and Puppet Strings

- Install the Yard gem as a gem used by the AIO Puppet installation.

  ```bash
  sudo puppet resource package yard provider=puppet_gem
  ```

- Install the Puppet Labs `strings` module.

  ```bash
  sudo puppet module install puppetlabs-strings
  ```

- Ensure that the `.yardopts` file exists in the root of each module.

  ```bash
  echo '--markup markdown' > /etc/puppetlabs/code/environments/test/modules/puppet/.yardopts
  ```

### Listing Parameters

- Parameters are documented with the `@param` meta tag.
- Document the default and expected values.

  ```markdown
  # @param [Type] sample_parameter Description of parameter
  # * `sample parameter`
  # Description of the parameter.
  ```

- __Example:__ The `puppet::client` class parameters from the module developed earlier.

  ```markdown
  # @param [Enum['running','stopped']] status Whether Puppet runs as a daemon
  # * `status`
  #   Whether Puppet agent should be running as a daemon
  #
  # @param [Boolean] enabled Whether Puppet client should start at boot
  # * `enabled`
  #   Whether Puppet agent should start at boot.
  #
  # @param [Hash] config Hash of configuration options for the [agent] section
  # * `config`
  #   Hash containing key/value pairs of Puppet configuration directives
  ```

### Documenting Variable References

- List any variables declared by this class that are not input parameters.
  - Internal variables created by the class.
  - Direct access of variables from other modules and clsses.
  - Direct Hiera lookups of data not passed in as parameters.
- Same syntax as parameters, but without the `@param` tag.
- __Example:__ Documenting the `puppet::agent` class developed previously.

  ```markdown
  ## Variables
  #
  # * `puppet::package_version`
  #   This uses the common $package_version variable provided by the base class
  #
  ```

### Showing Examples

- Documented with the `@examples` meta tag.
  - Include after this tag the name of the parameter and a description of its use.
- Document how to use the module, the required values, and the most likely use case.
- __Example:__ Using the `puppet::agent` class.

  ```markdown
  # Examples here (no header required)
  #
  # @examples Hiera data for using puppet::agent
  #   classes:
  #     - puppet::agent
  #
  #   puppet::agent::status = 'running'
  #   puppet::agent::enabled = true
  ```

### Listing Authors and Copyright

- List your name or the name(s) of any authors.
- Include an email address for questions.
  - Or the address of your issue tracking system.

  ```markdown
  ## Authors
  # Nick Alteen, CSE II
  #  - report issues at http://github.com/alteenn/mymodule/issues
  ```

- Identify the module copyright.
  - i.e. "[Employer Name], All Rights Reserved"
- If you're publishing for others, include a reference to the license in question.

  ```markdown
  ## Copyright
  # Copyright &copy; 2015 Acme Products
  # Licensed under the Apache License, version 2.0 (the "License");
  #   you may not use this module except in compliance with the License.
  #   http://www.apache.org/licenses/LICENSE-2.0
  ```

## Documenting Functions

- Document function parameters using the `@param` meta tag, followed by the input value type.
- Document function return values using the `@returns` meta tag, followed by type.

  ```markdown
  # @param [Type] sample_parameter - Description of the parameter
  # @returns [Type] - Description of the result
  # @since [String] - Description of version when the function became available
  ```

- It is not required to document a default alue as this is included in the parameter summary.
- Can include `@example` blocks exactly the same as classes.
- If the function is private, you can mark it as such with the `@api private` flag.

   ```ruby
   @api private
   Puppet::Functions.create_function(:'mymodule::get_subnet') do
   ```

## Generating Documentation

- Generate documentation by changing into the module path and running `puppet stings`.
- This reads each manifest and plugin, and creates final documentation from tags in them.
- The HTML documentation is placed in the `doc/` folder within the module.

  ```bash
  $ cd /etc/puppetlabs/code/environments/test/modules/puppet
  $ puppet strings
  Files:           6
  Modules:         0 (    0 undocumented)
  Classes:         0 (    0 undocumented)
  Constants:       0 (    0 undocumented)
  Attributes:      0 (    0 undocumented)
  Methods:         2 (    2 undocumented)
  Puppet Classes:     4 (    4 undocumented)
  Puppet Defined Types:     0 (    0 undocumented)
  Puppet Types:     0 (    0 undocumented)
  Puppet Providers:     1 (    0 undocumented)
    100.00% documented
  ```

## Updating Module Metadata

- An initial `metadata.json` file is generated by `puppet module generate`.
- This should be updated with content specific to your module.

### Identifying the License

- If publishing on Puppet Force, a license must be selected that allows others to use the module.
  - Apache 2.0
  - LGPL 3.0
  - BSD Simplified
  - BSD Revised
- Place all needed information in the LICENSE file of the module.

### Promoting the Project

- The `source`, `project`, and `issues` tags are used to create links in the Puppet Forge and private forges.
  - They inform users how to find documentation and submit issues related to the project.

  ```json
  "source": "https://github.com/exampleorg/exampleorg-puppet",
  "project_page": "https://forge.puppetlabs.com/exampleorg/puppet",
  "issues_url": "https://githhub.com/exampleorg/exampleorg-puppet/issues",
  ```

### Indicating Compatibility

- Inform the viewer which OSes and versions your module is known to work on.
- Defined as an array of hashes in the metadata.
  - Each hash contains an `operatingsystem` value (`$facts['os']['name']`), and an array of `operatingsystemrelease` values (`$facts['os']['release']['major']` or `$facts['os']['release']['major'].$facts['os']['release']['minor']`).
- These should correspond to the values under `$facts['os']`

  ```json
  "operatingsystem_support": [
      {
          "operatingsystem": "RedHat",
          "operatingsystemrelease": [ "6", "7" ]
      }
  ]
  ```

### Defining Requirements

- An array of hashes, each of which identifies a valid Puppet version.
  - Each hash contains a `name` (either 'pe' or 'puppet') and `version_requirement` (a comparison expression that can use both `<=` and `>=` operators).

  ```json
  "requirements": [
      { "name": "pe", "version_requirement": ">= 2015.0.0" },
      { "name": "puppet", "version_requirement": ">= 4.0.0" }
  ]
  ```

### Listing Dependencies

- List all modules required by this module in the dependencies section.
  - Indicate the `name` as shown on Puppet Forge and `version_requirement`.

  ```json
  "depdendencies": [
      { "name": "puppetlabs/stdlib", "version_requirement": ">= 3.2.0" },
      { "name": "puppetlabs/inifile", "version_requirement": ">= 1.0.2" }
  ]
  ```

### Identifying a Module Data Source

- If a module uses a data provider, list the provider type (valid values are `hiera`, `function`, or `none`).

  ```json
  "data_provider": "function"
  ```

### Updating Old Metadata

- The following changes are required when updating on an older module.
  - The `types` field has been removed.
  - PE version numbers have changed format.
    - PE 3.8 was the final version based on Puppet 3.
    - PE 2015.2 was the first version based on Puppet 4.

## Maintaining the Change Log

- `CHANGELOG.md` is not generated by default.
- Create and update it with every version change in your module.

  ```markdown
  ## YYYY-MM-DD - Release X.Y.Z
  ### Summary

  This release ...

  #### Features
    - Added new ...
    - Revised ...

  #### Deprecations
    - Removed support for ...

  #### Bugfixes
    - Fixed bug where ...
  ```

## Evolving and Improving

- The following tags are supported at this time:
  - `@example`: Show an example snipped of code for an object.
  - `@param`: Documents a single function or class parameter.
  - `@returns`: Describes the return value of a function or fact.
  - `@since`: Lists the version in which the fact or function was added.

## Best Practices for Documenting Modules

- Document every manifest using markdown within the file.
- Document each input parameter's type and acceptable values.
- Update the module version for every change released.
- Update the README and CHANGELOG for each version of the module.